{"id":"AGN-033-000","type":"ddr","ddr_id":"AGN-033","title":"AgentExecuteResponse Shape","status":"Approved","text":"AGN-033 defines the model-agnostic AgentExecuteResponse contract returned by Aptix agent execution APIs. It specifies a strict, minimal response envelope supporting two closed response kinds (final, client_tool_continuation), a final-only PrimaryOutputText (Markdown text), a client-tool continuation loop with exact ordered tool_call_id matching, a FileRef-only file model (no embedded binaries except Aptix bundles), and out-of-band diagnostics."}
{"id":"AGN-033-100","type":"section","ddr_id":"AGN-033","section":"3.1 Session Metadata","text":"Every successful AgentExecuteResponse MUST include SessionId, TurnId, and ModeDisplayName. Follow-on requests require exactly SessionId + TurnId. TurnId may be globally unique but is only valid within its SessionId room. ModeDisplayName is display-only; clients must not branch behavior based on it. Model/provider continuation identifiers and diagnostics are server-only."}
{"id":"AGN-033-110","type":"section","ddr_id":"AGN-033","section":"3.2 Response Kinds","text":"Kind is a required discriminator and is a closed enum for AGN-033. Allowed values: final, client_tool_continuation. Introducing a new Kind requires a new DDR and a new contract/version."}
{"id":"AGN-033-120","type":"section","ddr_id":"AGN-033","section":"3.4 Bucket Presence Rules","text":"Final responses require PrimaryOutputText (exactly one) and may include Files, ToolResults (server-executed visibility), UserWarnings, and Usage. Final responses must not include ToolCalls or ToolContinuationMessage. Client tool continuation responses require ToolCalls and may include ToolContinuationMessage, but must not include PrimaryOutputText, ToolResults, Files, UserWarnings, or Usage."}
{"id":"AGN-033-200","type":"section","ddr_id":"AGN-033","section":"4.1 Primary Output","text":"PrimaryOutputText is final-only, exactly one, always UTF-8 text with Markdown as the canonical format. Machine-consumable payloads must appear inside guarded fenced code blocks with language tags."}
{"id":"AGN-033-300","type":"section","ddr_id":"AGN-033","section":"5 Tool Interaction","text":"ToolCalls are server→client instructions (ToolCallId, Name, ArgumentsJson) emitted as an exact ordered set for client_tool_continuation. Client→server ToolResults must match ToolCalls exactly by count, ids, and order; mismatch is a hard-fault. ToolResult includes ToolCallId, ExecutionMs, and exactly one of ResultJson or ErrorMessage."}
{"id":"AGN-033-400","type":"section","ddr_id":"AGN-033","section":"6 Files","text":"AgentExecuteResponse does not embed files (no base64 blobs), except Aptix bundles inside guarded code blocks. Other files are returned as FileRef entries (Name, MimeType, Url, SizeBytes, ContentHash via IContentHashService IDX-016; optional Description and ContentExpires ISO-8601). Files[] may appear only on final responses."}
