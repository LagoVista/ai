# AGN-023 â€” DDR Ingestion & Derived Field Generation Contract

**ID:** AGN-023  
**Title:** DDR Ingestion & Derived Field Generation Contract  
**Type:** Generation  
**Status:** Approved

## Approval Metadata
- **Approved By:** Kevin Wolf  
- **Approval Timestamp:** 2025-12-21 (Local time, fallback EST)

---

## 1. Purpose & Scope

### 1.1 Purpose
This DDR defines the authoritative contract for ingesting Detailed Design Reviews (DDRs) into the Aptix system and generating all LLM-facing derived representations in a deterministic, validated, and auditable manner.

It establishes:
- What derived fields exist
- How they are generated
- How they are validated
- When human confirmation is required
- How batch ingestion is safely supported

This DDR exists to eliminate ambiguity, drift, and implicit behavior in DDR ingestion.

### 1.2 Scope
This DDR applies to:
- All DDR ingestion tooling
- All agent workflows that import DDRs
- All derived DDR representations used by agents, tools, and RAG systems

### 1.3 Out of Scope
This DDR does not define:
- DDR authoring templates
- RAG retrieval algorithms
- Prompt transport or UI behavior
- Runtime orchestration beyond ingestion

---

## 2. Authoritative Source Model

### 2.1 Primary Source
The Markdown DDR is the sole authoritative source of truth.

All identity, intent, constraints, and rules originate from the Markdown DDR.

### 2.2 Derived Fields
All derived fields:
- Are generated by an LLM at ingestion time
- Are non-authoritative projections
- Must be regenerated whenever the Markdown DDR changes
- Must preserve identity, approval metadata, and normative meaning

Derived fields MUST NOT be authored manually or edited independently.

---

## 3. DDR Types and Required Derived Fields

The ingestion tool MUST derive fields conditionally based on DDR Type.

### 3.1 Instruction DDR
Required:
- ModeInstructions
- HumanSummary
- RagIndexCard

Forbidden:
- ReferentialSummary
- CondensedContent

### 3.2 Referential DDR
Required:
- ReferentialSummary
- CondensedContent
- RagIndexCard

Forbidden:
- ModeInstructions

### 3.3 Generation DDR
Required:
- HumanSummary
- RagIndexCard

Forbidden:
- ModeInstructions
- ReferentialSummary

### 3.4 Policy / Rules / Governance DDR
Required:
- ModeInstructions
- HumanSummary
- RagIndexCard

Additional Rules:
- MUST be marked as requiring human confirmation prior to execution

---

## 4. Field Semantics

### 4.1 ModeInstructions
ModeInstructions are imperative, enforceable instruction sets intended for direct LLM execution.

They:
- MUST follow AGN-018
- MUST use normative keywords (MUST, MUST NOT, SHOULD, MAY)
- MUST NOT contain narrative explanation

### 4.2 HumanSummary
HumanSummary is a short, human-readable summary consisting of one to two complete sentences.

It:
- Is intended for UI display and review
- May use natural language
- Must not introduce new rules

### 4.3 ReferentialSummary
ReferentialSummary is an ultra-condensed identifier-oriented summary.

It:
- Is intended to be injected alongside many other summaries
- SHOULD be extremely short (often phrase-length)
- MUST include the DDR ID

### 4.4 CondensedContent
CondensedContent is a compressed but complete representation of normative meaning.

It:
- Preserves all rules
- Omits narrative and examples
- Is used as the default reasoning substrate

### 4.5 RagIndexCard
RagIndexCard is a one-to-two sentence routing representation.

It:
- Is optimized for retrieval
- Contains no normative rules
- Includes DDR ID, Type, Status, Approval Metadata, and purpose

---

## 5. Generation Model

### 5.1 LLM-Generated Only
All derived fields MUST be generated by invoking an LLM.

The agent MUST NOT attempt to procedurally derive summaries, instructions, or condensed content.

### 5.2 Single-Call Strategy
For performance reasons, the ingestion tool SHOULD request all required derived fields in a single LLM call.

Validation and enforcement occur at the agent level after generation.

---

## 6. Tool Usage Instructions (Normative)

The following ToolUsageInstructions MUST be applied verbatim by any DDR ingestion tool.

```
Imports an approved DDR from a Markdown document into the DDR store (create-only) and derives all required derived fields based on DDR type.

The tool MUST parse identifier, TLA, index, title, type, status, and approval metadata when present.
If the TLA-index already exists, the tool MUST reject the import and report the existing DDR.
If the parsed identifier does not match the parsed TLA-index, the tool MUST return an error.

The tool MUST determine the DDR type and conditionally generate derived fields as defined by AGN-023.

All derived fields MUST be generated by an LLM and validated by the agent.

If any derived field is missing, invalid, ambiguous, or violates its field contract, the tool MUST require human confirmation.

The tool MUST support a dry-run mode that performs parsing and generation without persistence.

In batch ingestion scenarios, the tool MAY persist DDRs in a quarantined state marked as NeedsHumanConfirmation.

Quarantined DDRs MUST NOT be treated as approved or injected into execution contexts.
```

---

## 7. Human Confirmation and Quarantine

### 7.1 NeedsHumanConfirmation Flag
The ingestion tool MUST mark a DDR as requiring human confirmation when:
- Metadata extraction is uncertain
- Derived fields violate field contracts
- Normative meaning cannot be confidently preserved

### 7.2 Batch Import Behavior
In batch scenarios:
- DDRs MAY be persisted in a quarantined state
- Status MUST NOT be Approved
- Execution and injection MUST be blocked

Human review is required to release a DDR from quarantine.

---

## 8. Validation Rules

- Identity mismatches are hard failures
- Missing required derived fields are hard failures
- Forbidden fields are hard failures
- Ambiguity results in quarantine, not silent correction

---

## 9. Observability

Ingestion tools SHOULD surface:
- Warnings
- Quarantine reasons
- Validation failures

This data SHOULD be retained for improving DDR authoring quality.

---

**End of AGN-023**