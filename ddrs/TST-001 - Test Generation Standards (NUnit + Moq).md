# TST-001 — Test Generation Standards (NUnit + Moq)

**ID:** TST-001  
**Title:** Test Generation Standards (NUnit + Moq)  
**Status:** Approved  
**DDR Type:** Instruction

## Approval Metadata
- **Approved By:** Kevin Wolf  
- **Approval Timestamp:** 2025-12-22

---

## 1. Purpose

TST-001 defines mandatory rules for generating automated tests using NUnit and Moq within the Aptix ecosystem. These rules ensure tests are stable, intention-revealing, and resistant to brittleness, especially when generated by LLMs at scale.

---

## 2. Scope

These rules apply to:
- All newly generated or regenerated tests
- Unit and tool-level tests using NUnit 4.x and Moq

This DDR governs how tests are written, not what production code does.

---

## 3. Mode Instructions (Executable Rules)

### 3.1 Behavioral Focus
- MUST test observable behavior, not implementation details
- MUST assert outcomes before verifying interactions
- MUST ensure each test has a single, clear reason to fail

### 3.2 Mocking Rules
- MUST default to MockBehavior.Loose
- MUST use MockBehavior.Strict only to enforce explicit guardrails
- MUST NOT verify calls unless the call itself is part of the contract
- MUST NOT use VerifyNoOtherCalls() unless all expected calls are explicitly verified

### 3.3 Verification Scope
- MUST verify only critical properties on complex objects
- MUST NOT assert full object equivalence unless it is the contract
- MUST explicitly assert non-persistence using Times.Never when blocking behavior is required

### 3.4 Logging
- MUST use the standard test logger unless logging behavior is under test
- MUST construct the default logger as: new AdminLogger(new ConsoleLogWriter());
- MUST include the following namespaces when using the default logger:
  - using LagoVista.IoT.Logging.Loggers;
  - using LagoVista.IoT.Logging;
- MUST NOT mock IAdminLogger by default
- MUST NOT verify logging calls unless explicitly required

### 3.5 InvokeResult Assertions
- MUST include result.ErrorMessage in all assertions on InvokeResult.Successful
- This rule applies whether success is expected or not

### 3.6 Assertion API
- MUST use NUnit assertion APIs exclusively
- MUST NOT use StringAssert under any circumstances

### 3.7 Helpers and DSLs
- MUST introduce small helper methods or a local test DSL when input or verification patterns repeat
- Helpers MUST express domain intent
- Helpers MUST NOT hide assertions or behavior

---

## 4. Brittleness Guardrails

Generated tests:
- MUST NOT assert timestamps or non-deterministic values
- MUST NOT rely on call ordering unless explicitly required
- MUST NOT over-specify serialized output unless serialization is the contract

---

## 5. Related DDRs

- **TST-002 — Canonical Test Patterns & Examples** (DDR Type: Referential)

TST-002 provides non-normative examples and templates and is referenced for guidance only. It does not introduce executable rules.

---

## 6. Relationship to SYS-001

TST-001 follows the SYS-001 Aptix Development Workflow and is enforced as an Instruction DDR. Deviations require explicit human approval.

---

# End of TST-001
