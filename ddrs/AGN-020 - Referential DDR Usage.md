# AGN-020 â€” Referential DDR Usage

**ID:** AGN-020  
**Title:** Referential DDR Usage  
**Status:** Approved

## Approval Metadata

- **Approved By:** Kevin Wolf  
- **Approval Timestamp:** 2025-12-20 (Local time, fallback EST)

---

## 1. Purpose & Scope

This DDR defines the **canonical meaning, structure, and usage model** of a **Referential Detailed Design Review (DDR)** within the Aptix ecosystem.

Referential DDRs are **authored by humans, for humans**. They are written as durable, complete, human-readable reference documents. However, Referential DDRs are **not consumed directly by LLMs**.

This DDR defines how a human-authored Referential DDR is **projected into the LLM world** through controlled, generated representations.

### Human-Authored, LLM-Projected Model

- The full human-authored DDR is the **authoritative source of truth**.
- LLM-facing content is **generated at ingestion time** via a dedicated Agent Tool.
- The generated content is stored with the DDR and used verbatim at runtime.

### In Scope

This DDR governs:
- What a Referential DDR is
- What it must contain
- How it is summarized and projected for LLM awareness
- How Referential DDRs interact with Agent Modes
- How LLMs are expected to reason when Referential context is present

### Out of Scope

This DDR does **not** define:
- RAG query mechanics or implementation
- Prompt layout or transport details
- Tool execution or workflow orchestration
- Procedural or step-by-step instructions

---

## 2. Definition of a Referential DDR

A **Referential DDR** is a canonical, human-authored reference document whose purpose is to define **what exists**, **what it means**, and **what constraints apply** within a given domain.

It is non-procedural, non-generative, and intended to change infrequently.

### Stored Content vs Derived Fields

A Referential DDR consists of two layers:

#### Authoritative Content

- Human-authored markdown and/or structured sections
- Fully reviewable and durable
- The sole source of truth

#### Derived Fields

Generated at ingestion time and stored with the DDR:

- **Referential Summary**
- **Referential Details**
- **RAG Summary**

Derived fields are projections for specific consumers and are never authoritative.

---

## 3. Worked Examples

This section provides **normative examples** that establish the intended mental model.

### Example: Authentication DDR

**Human-Authored DDR (Excerpt)**

Defines supported authentication mechanisms and constraints.

**Generated Referential Summary**

"AUTH-004: Authentication mechanisms + constraints (OAuth2, API keys). Ask for details if implementing auth."

**Generated Referential Details**

Defines canonical auth patterns, constraints on token lifetimes, API key exposure rules, and expected architectural shapes sufficient to produce repeatable code.

### Additional Platform DDR Examples

- Logging standards and conventions
- InvokeResult chaining and service orchestration
- Architectural layering (interfaces, managers, services, repositories, controllers, models)
- Self-describing UI models
- C# coding standards

These DDRs exist to ensure **consistent, standardized outputs** when code artifacts are generated.

---

## 4. Required Components of a Referential DDR

### 4.1 Human-Authored Content

Each Referential DDR must include:

- Identity & metadata
- Purpose & scope
- Canonical definitions
- Structural or conceptual organization
- Normative rules and constraints

### 4.2 Derived Fields

#### Referential Summary

- Extremely concise
- Includes the DDR identifier
- Functions as an index or table of contents
- Always injected when the associated mode is active

#### Referential Details

- Generated by an LLM at ingestion time
- Specific enough to drive repeatable outputs
- May include code shapes, patterns, and conventions
- Not injected by default; available only upon request

#### RAG Summary

- Optimized for semantic retrieval
- Used only for RAG queries
- Distinct in purpose from Referential Details

### Regeneration Rules

Any change to human-authored content requires regeneration of all derived fields.

---

## 5. Summary vs Full Detail Models

The Referential Summary acts as a **table of contents or index**.

- Summaries establish awareness
- Details provide shaping guidance
- Full DDR content is retrieved only when explicitly requested

This model balances token efficiency, precision, and repeatability.

---

## 6. Association with Agent Modes

Referential DDRs become active only through **association with an Agent Mode**.

- Each mode defines a list of applicable DDRs
- When a mode is active, all associated **Referential Summaries** are injected
- **Referential Details are pull-only** and provided only upon explicit request

This DDR does not define ordering, formatting, or transport of injected content.

---

## 7. Referential DDRs vs RAG

Referential DDRs and RAG serve different purposes:

- Referential DDRs provide **awareness, shape, and constraints**
- RAG provides **targeted, task-scoped retrieval**

Awareness must always precede retrieval. The two must never be conflated.

---

## 8. LLM Interpretation & Behavior Rules

When Referential Summaries are present, the LLM must:

- Treat them as an index of existing standards
- Avoid inventing patterns in covered domains
- Request Referential Details when shaping or compliance is required
- Surface missing guidance for common concerns rather than inventing new standards

The system biases toward **reuse over invention** and improves over time by detecting gaps.

---

## 9. LLM Instruction Templates

This DDR defines canonical instruction patterns for:

- Referential DDR ingestion
- Summary generation
- Detail generation
- Task-time LLM behavior
- Missing-guidance escalation

These templates encode the normative semantics defined by this DDR and are intended for direct use by Agent Tools and runtimes.

---

## 10. Validation & Compliance Checklist

A Referential DDR is compliant only if:

- Human-authored content is complete and authoritative
- Referential Summary, Details, and RAG Summary exist
- Summaries are concise and include DDR identifiers
- Details are repeatability-grade and pull-only
- RAG summaries are retrieval-only
- Derived fields are generated at ingestion time and regenerated on change
- LLM behavior follows awareness-first, reuse-over-invention principles

---

**End of AGN-020**
